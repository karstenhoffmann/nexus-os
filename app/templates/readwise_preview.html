{% extends "base.html" %}
{% block content %}

<h1>Readwise Preview</h1>

{% if error %}
<div class="card error">{{ error }}</div>
{% endif %}

{% if not token %}
<div class="card">
  <h2>Token eingeben</h2>
  <p>Readwise Reader API Token (findest du unter <a href="https://readwise.io/access_token" target="_blank">readwise.io/access_token</a>)</p>
  <form method="post" action="/readwise/preview">
    <input type="password" name="token" placeholder="Token hier einfuegen" required>
    <button type="submit">Verbinden</button>
  </form>
</div>
{% else %}

<div class="card">
  <h2>Verbunden</h2>
  <p>Zeige die letzten {{ articles|length }} Artikel.</p>
</div>

{% if articles %}
<div class="table-wrapper">
<table class="data-table">
  <thead>
    <tr>
      <th>Titel</th>
      <th>Autor</th>
      <th>Kategorie</th>
      <th>Woerter</th>
    </tr>
  </thead>
  <tbody>
    {% for a in articles %}
    <tr>
      <td>
        <a href="/readwise/article/{{ a.provider_id }}?token={{ token_param }}">{{ a.title }}</a>
      </td>
      <td>{{ a.author or "-" }}</td>
      <td>{{ a.category }}</td>
      <td>{{ a.word_count or "-" }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% else %}
<p>Keine Artikel gefunden.</p>
{% endif %}

{% endif %}

{% endblock %}
