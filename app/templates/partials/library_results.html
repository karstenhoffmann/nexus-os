{% if rows %}
{% from "macros/icons.html" import icon %}
<div class="overflow-x-auto">
<table class="table table-zebra">
  <thead>
    <tr>
      <th class="cursor-pointer hover:bg-base-200{% if sort_by == 'title' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('title')">
        <span class="flex items-center gap-1">Titel {% if sort_by == 'title' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      <th class="cursor-pointer hover:bg-base-200 text-right{% if sort_by == 'highlight_count' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('highlight_count')">
        <span class="flex items-center justify-end gap-1">{{ icon("bookmark") }} {% if sort_by == 'highlight_count' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      <th class="cursor-pointer hover:bg-base-200{% if sort_by == 'author' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('author')">
        <span class="flex items-center gap-1">Autor {% if sort_by == 'author' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      <th class="cursor-pointer hover:bg-base-200{% if sort_by == 'category' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('category')">
        <span class="flex items-center gap-1">Typ {% if sort_by == 'category' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      <th class="cursor-pointer hover:bg-base-200{% if sort_by == 'saved_at' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('saved_at')">
        <span class="flex items-center gap-1">Datum {% if sort_by == 'saved_at' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      <th class="cursor-pointer hover:bg-base-200 text-right{% if sort_by == 'word_count' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('word_count')">
        <span class="flex items-center justify-end gap-1">Woerter {% if sort_by == 'word_count' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      {% if mode == 'semantic' %}
      <th class="cursor-pointer hover:bg-base-200 text-right{% if sort_by == 'distance' %} bg-base-200{% endif %}" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('distance')">
        <span class="flex items-center justify-end gap-1">Score {% if sort_by == 'distance' %}{{ icon("chevron-up" if sort_dir == 'asc' else "chevron-down") }}{% endif %}</span>
      </th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr class="hover">
      <td class="max-w-md">
        <a href="/documents/{{ r.id }}" class="font-medium link link-hover">{{ r.title or ("Doc #" ~ r.id) }}</a>
        {% if r.url %}
        <div class="flex items-center gap-1 mt-1 text-xs text-base-content/60">
          {{ icon("external-link") }}
          <a href="{{ r.url }}" target="_blank" rel="noopener" class="link link-hover truncate">{{ r.url[:60] }}{% if r.url|length > 60 %}...{% endif %}</a>
        </div>
        {% endif %}
        {% if r.chunk_text %}
        <div class="text-xs text-base-content/60 mt-1 italic line-clamp-2">
          {{ r.chunk_text[:150] }}{% if r.chunk_text|length > 150 %}...{% endif %}
        </div>
        {% endif %}
      </td>
      <td class="text-right">
        {% if r.highlight_count %}
        <span class="badge badge-warning badge-sm">{{ r.highlight_count }}</span>
        {% else %}
        <span class="badge badge-ghost badge-sm">0</span>
        {% endif %}
      </td>
      <td>{{ r.author or "-" }}</td>
      <td>
        {# Category badge mapping to DaisyUI semantic colors #}
        {% set cat = r.category or 'article' %}
        <span class="badge badge-sm {% if cat == 'article' %}badge-primary{% elif cat == 'pdf' %}badge-error{% elif cat == 'podcast' %}badge-warning{% elif cat == 'video' %}badge-success{% elif cat in ['tweet', 'linkedin'] %}badge-info{% elif cat == 'epub' %}badge-secondary{% elif cat == 'note' %}badge-accent{% else %}badge-ghost{% endif %}">{{ cat }}</span>
      </td>
      <td class="whitespace-nowrap">{{ r.saved_at | dateformat }}</td>
      <td class="text-right tabular-nums">{{ "{:,}".format(r.word_count).replace(",", ".") if r.word_count else "-" }}</td>
      {% if mode == 'semantic' %}
      <td class="text-right tabular-nums">{{ "%.3f"|format(r.distance) if r.distance is not none else "-" }}</td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>

{% else %}
<div class="text-center py-12 text-base-content/60">
  <div class="text-5xl opacity-30 mb-4">{{ icon("search") }}</div>
  <p>Keine Ergebnisse gefunden.</p>
</div>
{% endif %}
