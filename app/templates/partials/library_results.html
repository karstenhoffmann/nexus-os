{% if rows %}
<table class="data-table library-table">
  <thead>
    <tr>
      <th class="sortable" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('title')">
        Titel
        {% if sort_by == 'title' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      <th class="sortable" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('author')">
        Autor
        {% if sort_by == 'author' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      <th class="sortable" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('category')">
        Typ
        {% if sort_by == 'category' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      <th class="sortable" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('saved_at')">
        Datum
        {% if sort_by == 'saved_at' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      <th class="sortable col-numeric" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('word_count')">
        Woerter
        {% if sort_by == 'word_count' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      {% if mode == 'semantic' %}
      <th class="sortable col-numeric" onclick="Alpine.$data(document.querySelector('[x-data]')).toggleSort('distance')">
        Score
        {% if sort_by == 'distance' %}
          <i data-feather="chevron-{{ 'up' if sort_dir == 'asc' else 'down' }}"></i>
        {% endif %}
      </th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td class="col-title">
        <a href="/documents/{{ r.id }}">{{ r.title or ("Doc #" ~ r.id) }}</a>
        {% if r.chunk_text %}
        <div class="chunk-preview">
          {{ r.chunk_text[:150] }}{% if r.chunk_text|length > 150 %}...{% endif %}
        </div>
        {% endif %}
      </td>
      <td>{{ r.author or "-" }}</td>
      <td>
        <span class="badge badge-{{ r.category or 'article' }}">{{ r.category or "article" }}</span>
      </td>
      <td class="col-date">{{ r.saved_at[:10] if r.saved_at else "-" }}</td>
      <td class="col-numeric">{{ "{:,}".format(r.word_count).replace(",", ".") if r.word_count else "-" }}</td>
      {% if mode == 'semantic' %}
      <td class="col-numeric">{{ "%.3f"|format(r.distance) if r.distance is not none else "-" }}</td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
// Re-render feather icons after HTMX swap
feather.replace();
</script>

{% else %}
<div class="empty-state">
  <i data-feather="search" class="empty-icon"></i>
  <p>Keine Ergebnisse gefunden.</p>
</div>
<script>feather.replace();</script>
{% endif %}

<style>
.library-table {
  width: 100%;
}

.library-table th.sortable {
  cursor: pointer;
  user-select: none;
  white-space: nowrap;
}

.library-table th.sortable:hover {
  background: var(--bg-hover);
}

.library-table th svg,
.library-table th i {
  width: 0.75rem;
  height: 0.75rem;
  margin-left: 0.25rem;
  vertical-align: middle;
}

.col-title {
  max-width: 400px;
}

.col-title a {
  font-weight: var(--font-weight-medium);
}

.chunk-preview {
  font-size: var(--font-size-xs);
  color: var(--text-muted);
  margin-top: 0.25rem;
  line-height: 1.4;
  font-style: italic;
}

.col-date {
  white-space: nowrap;
}

.col-numeric {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* Category Badges */
.badge {
  display: inline-block;
  padding: 0.125rem 0.5rem;
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  text-transform: lowercase;
}

.badge-article {
  background: var(--primary-bg, rgba(59, 130, 246, 0.1));
  color: var(--primary);
}

.badge-pdf {
  background: rgba(239, 68, 68, 0.1);
  color: #dc2626;
}

.badge-podcast {
  background: rgba(245, 158, 11, 0.1);
  color: #d97706;
}

.badge-video {
  background: rgba(34, 197, 94, 0.1);
  color: #16a34a;
}

.badge-tweet {
  background: rgba(29, 161, 242, 0.1);
  color: #1da1f2;
}

.badge-email, .badge-rss {
  background: var(--bg-secondary);
  color: var(--text-secondary);
}

.badge-epub {
  background: rgba(168, 85, 247, 0.1);
  color: #9333ea;
}

.badge-note {
  background: rgba(236, 72, 153, 0.1);
  color: #db2777;
}

.badge-highlight {
  background: rgba(251, 191, 36, 0.1);
  color: #f59e0b;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: var(--space-xxl) var(--space-lg);
  color: var(--text-muted);
}

.empty-icon {
  width: 3rem;
  height: 3rem;
  opacity: 0.3;
  margin-bottom: var(--space-md);
}
</style>
