
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>nexus-os</title>
  <link rel="stylesheet" href="/static/app.css">
  <script defer src="/static/htmx.min.js"></script>
  <script defer src="/static/alpine.min.js"></script>
  <script>
    // Theme-Presets mit CSS-Variable-Mappings
    const themePresets = {
      spacing: {
        compact: {
          '--card-padding': '0.875rem',
          '--card-gap': '0.875rem',
          '--section-gap': '1rem',
          '--button-padding-x': '0.75rem',
          '--button-padding-y': '0.5rem',
          '--space-md': '0.75rem',
          '--space-lg': '1rem'
        },
        normal: {
          '--card-padding': '1.25rem',
          '--card-gap': '1.25rem',
          '--section-gap': '1.5rem',
          '--button-padding-x': '1rem',
          '--button-padding-y': '0.625rem',
          '--space-md': '1rem',
          '--space-lg': '1.5rem'
        },
        spacious: {
          '--card-padding': '1.75rem',
          '--card-gap': '1.75rem',
          '--section-gap': '2rem',
          '--button-padding-x': '1.25rem',
          '--button-padding-y': '0.75rem',
          '--space-md': '1.25rem',
          '--space-lg': '2rem'
        }
      },
      radius: {
        sharp: {
          '--radius-sm': '2px',
          '--radius-md': '4px',
          '--radius-lg': '6px',
          '--radius-xl': '8px'
        },
        rounded: {
          '--radius-sm': '6px',
          '--radius-md': '8px',
          '--radius-lg': '12px',
          '--radius-xl': '16px'
        },
        pill: {
          '--radius-sm': '10px',
          '--radius-md': '14px',
          '--radius-lg': '20px',
          '--radius-xl': '28px'
        }
      },
      fontSize: {
        small: {
          '--font-size-xs': '0.7rem',
          '--font-size-sm': '0.8rem',
          '--font-size-base': '0.9rem',
          '--font-size-lg': '1rem',
          '--font-size-xl': '1.1rem',
          '--font-size-2xl': '1.3rem',
          '--font-size-3xl': '1.6rem'
        },
        medium: {
          '--font-size-xs': '0.75rem',
          '--font-size-sm': '0.875rem',
          '--font-size-base': '1rem',
          '--font-size-lg': '1.125rem',
          '--font-size-xl': '1.25rem',
          '--font-size-2xl': '1.5rem',
          '--font-size-3xl': '1.875rem'
        },
        large: {
          '--font-size-xs': '0.8rem',
          '--font-size-sm': '0.95rem',
          '--font-size-base': '1.1rem',
          '--font-size-lg': '1.25rem',
          '--font-size-xl': '1.4rem',
          '--font-size-2xl': '1.7rem',
          '--font-size-3xl': '2.1rem'
        }
      }
    };

    // Theme anwenden (global verfuegbar)
    window.applyTheme = function(theme) {
      const root = document.documentElement;

      // Primaerfarbe
      if (theme.primary) {
        root.style.setProperty('--primary', theme.primary);
        // Hover-Farbe berechnen (etwas dunkler)
        const hex = theme.primary.replace('#', '');
        const r = parseInt(hex.substr(0,2), 16);
        const g = parseInt(hex.substr(2,2), 16);
        const b = parseInt(hex.substr(4,2), 16);
        const hover = '#' + [r,g,b].map(c => Math.max(0, c - 30).toString(16).padStart(2,'0')).join('');
        root.style.setProperty('--primary-hover', hover);
        // Light-Variante
        root.style.setProperty('--primary-light', theme.primary + '1a');
      }

      // Spacing Preset
      if (theme.spacing && themePresets.spacing[theme.spacing]) {
        Object.entries(themePresets.spacing[theme.spacing]).forEach(([prop, val]) => {
          root.style.setProperty(prop, val);
        });
      }

      // Radius Preset
      if (theme.radius && themePresets.radius[theme.radius]) {
        Object.entries(themePresets.radius[theme.radius]).forEach(([prop, val]) => {
          root.style.setProperty(prop, val);
        });
      }

      // Font Size Preset
      if (theme.fontSize && themePresets.fontSize[theme.fontSize]) {
        Object.entries(themePresets.fontSize[theme.fontSize]).forEach(([prop, val]) => {
          root.style.setProperty(prop, val);
        });
      }
    };

    // Theme aus DB laden und anwenden
    fetch('/api/admin/theme')
      .then(r => r.json())
      .then(theme => window.applyTheme(theme))
      .catch(() => {}); // Ignoriere Fehler, Default-Werte greifen

    // Dark Mode Toggle
    window.toggleTheme = function() {
      const root = document.documentElement;
      const current = root.getAttribute('data-theme');
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      let newTheme;
      if (current === 'dark') {
        newTheme = 'light';
      } else if (current === 'light') {
        newTheme = 'dark';
      } else {
        // No manual override yet - toggle opposite of system
        newTheme = systemDark ? 'light' : 'dark';
      }

      root.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    };

    window.updateThemeIcon = function(theme) {
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = theme === 'dark' || (!theme && systemDark);
      btn.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
      btn.title = isDark ? 'Light Mode' : 'Dark Mode';
    };

    // Restore saved theme on load
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
      }
      updateThemeIcon(saved);

      // Set active nav link
      const path = window.location.pathname;
      document.querySelectorAll('.nav a').forEach(a => {
        const href = a.getAttribute('href');
        if (path === href || (href !== '/' && path.startsWith(href))) {
          a.classList.add('active');
        }
      });
    });
  </script>
</head>
<body>
  <header class="topbar">
    <div class="container row">
      <div class="brand"><a href="/">nexus-os</a></div>
      <nav class="nav">
        <a href="/library">Library</a>
        <a href="/digests">Digests</a>
        <a href="/drafts">Drafts</a>
        <a href="/readwise/preview">Readwise</a>
        <a href="/readwise/import">Import</a>
        <a href="/admin">Admin</a>
        <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">ðŸŒ™</button>
      </nav>
    </div>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="container footer">
    <div>Local-first. Single user. Guardrails on.</div>
  </footer>
</body>
</html>
